{"version":3,"file":"index.js","sources":["../../src/createAbsintheSocketLink.js"],"sourcesContent":["// @flow\n\nimport {ApolloLink} from \"apollo-link\";\nimport {send, toObservable, unobserveOrCancel} from \"@absinthe/socket\";\nimport {compose} from \"flow-static-land/lib/Fun\";\nimport {print} from \"graphql\";\n\nimport type {AbsintheSocket, GqlRequest, Observer} from \"@absinthe/socket\";\nimport type {DocumentNode} from \"graphql/language/ast\";\n\ntype ApolloOperation<Variables> = {|\n  query: DocumentNode,\n  variables: Variables\n|};\n\nconst unobserveOrCancelIfNeeded = (absintheSocket, notifier, observer) => {\n  if (notifier && observer) {\n    unobserveOrCancel(absintheSocket, notifier, observer);\n  }\n};\n\nconst notifierToObservable = (absintheSocket, onError, onStart) => notifier =>\n  toObservable(absintheSocket, notifier, {\n    onError,\n    onStart,\n    unsubscribe: unobserveOrCancelIfNeeded\n  });\n\nconst getRequest = <Variables: Object>({\n  query,\n  variables\n}: ApolloOperation<Variables>): GqlRequest<Variables> => ({\n  operation: print(query),\n  variables\n});\n\n/**\n * Creates a terminating ApolloLink to request operations using given\n * AbsintheSocket instance\n */\nconst createAbsintheSocketLink = <Result, Variables: void | Object>(\n  absintheSocket: AbsintheSocket,\n  onError?: $ElementType<Observer<Result, Variables>, \"onError\">,\n  onStart?: $ElementType<Observer<Result, Variables>, \"onStart\">\n) =>\n  new ApolloLink(\n    compose(\n      notifierToObservable(absintheSocket, onError, onStart),\n      request => send(absintheSocket, request),\n      getRequest\n    )\n  );\n\nexport default createAbsintheSocketLink;\n"],"names":["unobserveOrCancelIfNeeded","absintheSocket","notifier","observer","unobserveOrCancel","notifierToObservable","onError","onStart","toObservable","unsubscribe","getRequest","query","variables","operation","print","createAbsintheSocketLink","ApolloLink","compose","request","send"],"mappings":";;;;;;;;;;;;;;;AAeA,IAAMA,yBAAyB,GAAG,mCAACC,cAAD,EAAiBC,QAAjB,EAA2BC,QAA3B,EAAwC;;;MACpED,QAAQ,IAAIC,QAAhB,EAA0B;IACxBC,wBAAiB,CAACH,cAAD,EAAiBC,QAAjB,EAA2BC,QAA3B,CAAjB;;CAF2B,gBAA/B;;AAMA,IAAME,oBAAoB,GAAG,8BAACJ,cAAD,EAAiBK,OAAjB,EAA0BC,OAA1B;;;;;SAAsC,UAAAL,QAAQ;;;WACzEM,mBAAY,CAACP,cAAD,EAAiBC,QAAjB,EAA2B;MACrCI,OAAO,EAAPA,OADqC;MAErCC,OAAO,EAAPA,OAFqC;MAGrCE,WAAW,EAAET;KAHH,CAD6D;GAA9C;CAAH,gBAA1B;;AAOA,IAAMU,UAAU,GAAG;MACjBC,KADiB,QACjBA,KADiB;MAEjBC,SAFiB,QAEjBA,SAFiB;;;;SAGuC;IACxDC,SAAS,EAAEC,aAAK,CAACH,KAAD,CADwC;IAExDC,SAAS,EAATA;GALiB;CAAH,gBAAhB;;;;;;;AAYA,IAAMG,wBAAwB,GAAG,kCAC/Bd,cAD+B,EAE/BK,OAF+B,EAG/BC,OAH+B;;;;;SAK/B,IAAIS,qBAAJ,CACEC,WAAO,CACLZ,oBAAoB,CAACJ,cAAD,EAAiBK,OAAjB,EAA0BC,OAA1B,CADf,EAEL,UAAAW,OAAO;;;WAAIC,WAAI,CAAClB,cAAD,EAAiBiB,OAAjB,CAAR;GAFF,aAGLR,UAHK,CADT,CAL+B;CAAH,gBAA9B;;;;"}